pipeline {
    agent any
    tools {
        // Install the Maven version configured as "Maven3.9.12" and add it to the path.
        maven "Maven3.9.12"
        jdk 'Corretto-17'
    }
    environment {
        // Configuration générale
        PROJECT_KEY = "KAN"
    }
    options {
        parallelsAlwaysFailFast()
    }
    stages {
        parallel {
            stage('Build Petclinic Checkstyle') {
                steps {
                    sh 'mvn clean package checkstyle:checkstyle'
                }
            }

            stage('Q/A Analysis (SonarQube)') {
            steps {
                // Analyse statique du code

                    withSonarQubeEnv('SonarQube') {
                    sh "mvn org.sonarsource.scanner.maven:sonar-maven-plugin:sonar -Dsonar.projectKey=${PROJECT_KEY}"

                    }
                }
                post {
                // If Maven was able to run the tests, even if some of the test
                    // failed, record the test results and archive the jar file.
                    success {
                    junit '**/target/surefire-reports/TEST-*.xml'
                        archiveArtifacts 'target/*.war'

                    }
                }
            }
        }
   }
}
